# altoro_mutual_test

## EXEL LINK

https://1drv.ms/x/c/980a678827ce5c88/EWfM-PfNH_1IqPPBNCKRaf4BgO-GvHXeTOF3uGBOqSfH4w?e=IvMECK

## Authentication

### 2.1.1

### 2.1.2

### 2.1.3

### 2.1.4

### 2.1.5

### 2.1.6

### 2.1.7

### 2.1.8

### 2.1.9

### 2.1.10

### 2.1.11

### 2.1.12

---

### 2.2.1

### 2.2.2

### 2.2.3

### 2.2.4

### 2.2.5

### 2.2.6

### 2.2.7

---

### 2.3.1

### 2.3.2

### 2.3.3

---

### 2.4.1

### 2.4.2

### 2.4.3

### 2.4.4

### 2.4.5


## Access Control

### 4.1.1

Admin panel accessed by non admin user.

![alt text](image.png)

Admin panel accessed by admin user.

![alt text](image-1.png)

#### FIX:

Add the following code at the third line of [admin.jsp](https://github.com/HCL-TECH-SOFTWARE/AltoroJ/blob/AltoroJ-3.2/WebContent/admin/admin.jsp) to solve the issue.

~~~JSP
<%
    User user = (com.ibm.security.appscan.altoromutual.model.User)request.getSession().getAttribute("user");

    if (user == null || user.getRole() != User.Role.Admin) {
        response.sendError(HttpServletResponse.SC_FORBIDDEN, "Access denied");
        return;
    }
%>
~~~

### 4.1.2

Example of non admin user changing the password of arbritary user.

![alt text](image-2.png)

Burp showing 200 OK response to the request.

![alt text](image-3.png)

#### FIX:

Add the following code at line 41 [AdminServlet.java](https://github.com/HCL-TECH-SOFTWARE/AltoroJ/blob/AltoroJ-3.2/src/com/ibm/security/appscan/altoromutual/servlet/AdminServlet.java) so non admin users cant make admin actions.

~~~java
User user = (User) request.getSession().getAttribute("user");

if (user == null) {
    response.sendError(HttpServletResponse.SC_UNAUTHORIZED, "Login required");
    return;
}

if (user.getRole() != User.Role.Admin) {
    response.sendError(HttpServletResponse.SC_FORBIDDEN, "Admin only");
    return;
}
~~~

### 4.1.3

The proof that invalidates this one can be the previous points 4.1.1 and 4.1.2, since a non admin user should not have the provilege of accessing and doing admin actions

#### FIX:

The fix from 4.1.2 remediates this issue too.

### 4.1.5

This one gets its proof from 4.1.1 and 4.1.2 since the app should be failing when a non admin user tries to access admin functionalities

#### FIX:

Both fixes from 4.1.1 and 4.1.2 would remediates this issue allowing the app to fail safely.

---

### 4.2.1

The test account should only have access to this information:

![alt text](image-4.png)

By changing the *listAccounts* parameter in the URL it was possible to access the account information of another user

![alt text](image-5.png)

#### FIX:

To solve the issue add this code in the 42 line of the file [balance.jsp](https://github.com/HCL-TECH-SOFTWARE/AltoroJ/blob/AltoroJ-3.2/WebContent/bank/balance.jsp) making users only accesible to their content.

~~~ java
boolean isOwned = accounts.stream().anyMatch(a -> a.getId().equals(accountName));

if (!isOwned) {
    response.sendError(HttpServletResponse.SC_FORBIDDEN, "Unauthorized account access");
    return;
}
~~~

### 4.2.2

CSRF test generated by burp:

![alt text](image-6.png)

Proof in the browser:

![alt text](image-7.png)

Request successful developer tools:

![alt text](image-8.png)



---

### 4.3.1

The following workflow show how they is not multifactor authentication for accessing the admin panel

1. Admin login

![alt text](image-9.png)

2. Admin account

![alt text](image-10.png)

3. Admin panel

![alt text](image-11.png)

### 4.3.3

This one gets invalidated because of points 4.1.1, 4.1.2 and 4.3.1 since there are no checks for actions


## Communication Security

### 9.1.1

### 9.1.2

### 9.1.3

---

### 9.2.1

### 9.2.2

### 9.2.3

### 9.2.4

### 9.2.5